var ScrollOut=function(){"use strict";function clamp(v,min,max){return min>v?min:max<v?max:v}function sign(x){return+(x>0)-+(x<0)}function round(n){return Math.round(1e4*n)/1e4}var cache={},clearTask;function replacer(match){return"-"+match[0].toLowerCase()}function hyphenate(value){return cache[value]||(cache[value]=value.replace(/([A-Z])/g,replacer))}function $(e,parent){return e&&0!==e.length?e.nodeName?[e]:[].slice.call(e[0].nodeName?e:(parent||document.documentElement).querySelectorAll(e)):[]}function setAttrs(el,attrs){for(var key in attrs)key.indexOf("_")&&el.setAttribute("data-"+hyphenate(key),attrs[key])}function setProps(cssProps){return function(el,props){for(var key in props)key.indexOf("_")&&(!0===cssProps||cssProps[key])&&el.style.setProperty("--"+hyphenate(key),round(props[key]))}}var subscribers=[];function loop(){clearTask=0,subscribers.slice().forEach((function(s2){return s2()})),enqueue()}function enqueue(){!clearTask&&subscribers.length&&(clearTask=requestAnimationFrame(loop))}function subscribe(fn){return subscribers.push(fn),enqueue(),function(){!(subscribers=subscribers.filter((function(s){return s!==fn}))).length&&clearTask&&(cancelAnimationFrame(clearTask),clearTask=0)}}function unwrap(value,el,ctx,doc){return"function"==typeof value?value(el,ctx,doc):value}function noop(){}function main(opts){var onChange=(opts=opts||{}).onChange||noop,onHidden=opts.onHidden||noop,onShown=opts.onShown||noop,onScroll=opts.onScroll||noop,props=opts.cssProps?setProps(opts.cssProps):noop,se=opts.scrollingElement,container=se?$(se)[0]:window,doc=se?$(se)[0]:document.documentElement,rootChanged=!1,scrollingElementContext={},elementContextList=[],clientOffsetX,clientOffsety,sub;function index(){elementContextList=$(opts.targets||"[data-scroll]",$(opts.scope||doc)[0]).map((function(el){return{element:el}}))}function update(){var clientWidth=doc.clientWidth,clientHeight=doc.clientHeight,scrollDirX=sign(-clientOffsetX+(clientOffsetX=doc.scrollLeft||window.pageXOffset)),scrollDirY=sign(-clientOffsety+(clientOffsety=doc.scrollTop||window.pageYOffset)),scrollPercentX=doc.scrollLeft/(doc.scrollWidth-clientWidth||1),scrollPercentY=doc.scrollTop/(doc.scrollHeight-clientHeight||1);rootChanged=rootChanged||scrollingElementContext.scrollDirX!==scrollDirX||scrollingElementContext.scrollDirY!==scrollDirY||scrollingElementContext.scrollPercentX!==scrollPercentX||scrollingElementContext.scrollPercentY!==scrollPercentY,scrollingElementContext.scrollDirX=scrollDirX,scrollingElementContext.scrollDirY=scrollDirY,scrollingElementContext.scrollPercentX=scrollPercentX,scrollingElementContext.scrollPercentY=scrollPercentY;for(var childChanged=!1,index_1=0;index_1<elementContextList.length;index_1++){var ctx=elementContextList[index_1],element=ctx.element,target=element,offsetX=0,offsetY=0;do{offsetX+=target.offsetLeft,offsetY+=target.offsetTop,target=target.offsetParent}while(target&&target!==container);var elementHeight=element.clientHeight||element.offsetHeight||0,elementWidth=element.clientWidth||element.offsetWidth||0,visibleX=(clamp(offsetX+elementWidth,clientOffsetX,clientOffsetX+clientWidth)-clamp(offsetX,clientOffsetX,clientOffsetX+clientWidth))/elementWidth,visibleY=(clamp(offsetY+elementHeight,clientOffsety,clientOffsety+clientHeight)-clamp(offsetY,clientOffsety,clientOffsety+clientHeight))/elementHeight,intersectX=1===visibleX?0:sign(offsetX-clientOffsetX),intersectY=1===visibleY?0:sign(offsetY-clientOffsety),viewportX=clamp((clientOffsetX-(elementWidth/2+offsetX-clientWidth/2))/(clientWidth/2),-1,1),viewportY=clamp((clientOffsety-(elementHeight/2+offsetY-clientHeight/2))/(clientHeight/2),-1,1),visible=void 0;visible=opts.offset?unwrap(opts.offset,element,ctx,doc)<=clientOffsety?1:0:(unwrap(opts.threshold,element,ctx,doc)||0)<visibleX*visibleY?1:0;var changedVisible=ctx.visible!==visible,changed;(ctx._changed||changedVisible||ctx.visibleX!==visibleX||ctx.visibleY!==visibleY||ctx.index!==index_1||ctx.elementHeight!==elementHeight||ctx.elementWidth!==elementWidth||ctx.offsetX!==offsetX||ctx.offsetY!==offsetY||ctx.intersectX!=ctx.intersectX||ctx.intersectY!=ctx.intersectY||ctx.viewportX!==viewportX||ctx.viewportY!==viewportY)&&(childChanged=!0,ctx._changed=!0,ctx._visibleChanged=changedVisible,ctx.visible=visible,ctx.elementHeight=elementHeight,ctx.elementWidth=elementWidth,ctx.index=index_1,ctx.offsetX=offsetX,ctx.offsetY=offsetY,ctx.visibleX=visibleX,ctx.visibleY=visibleY,ctx.intersectX=intersectX,ctx.intersectY=intersectY,ctx.viewportX=viewportX,ctx.viewportY=viewportY,ctx.visible=visible)}sub||!rootChanged&&!childChanged||(sub=subscribe(render))}function render(){maybeUnsubscribe(),rootChanged&&(rootChanged=!1,setAttrs(doc,{scrollDirX:scrollingElementContext.scrollDirX,scrollDirY:scrollingElementContext.scrollDirY}),props(doc,scrollingElementContext),onScroll(doc,scrollingElementContext,elementContextList));for(var len,x=elementContextList.length-1;x>-1;x--){var ctx=elementContextList[x],el=ctx.element,visible=ctx.visible,justOnce=el.hasAttribute("scrollout-once")||!1;ctx._changed&&(ctx._changed=!1,props(el,ctx)),ctx._visibleChanged&&(setAttrs(el,{scroll:visible?"in":"out"}),onChange(el,ctx,doc),(visible?onShown:onHidden)(el,ctx,doc)),visible&&(opts.once||justOnce)&&elementContextList.splice(x,1)}}function maybeUnsubscribe(){sub&&(sub(),sub=void 0)}index(),update(),render();var updateTaskId=0,onUpdate=function(){updateTaskId=updateTaskId||setTimeout((function(){updateTaskId=0,update()}),0)};return window.addEventListener("resize",onUpdate),container.addEventListener("scroll",onUpdate),{index:index,update:update,teardown:function(){maybeUnsubscribe(),window.removeEventListener("resize",onUpdate),container.removeEventListener("scroll",onUpdate)}}}return main}();